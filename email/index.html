<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title>HAD Tester</title>

    <!-- Bootstrap core CSS -->
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/bootstrap/docs/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/jumbotron.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style>
</style>

  <script src="dropzone.js"></script>
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"><img src="/nist_logo_reverse.svg" height=12x> DANE-TEST.HAD.DNSOPS.GOV</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <!--
          <form class="navbar-form navbar-right">
            <div class="form-group">
              <input type="text" placeholder="Email" class="form-control">
            </div>
            <div class="form-group">
              <input type="password" placeholder="Password" class="form-control">
            </div>
            <button type="submit" class="btn btn-success">Sign in</button>
          </form> -->

        </div><!--/.navbar-collapse -->
      </div>
    </nav>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>Email Tester</h1>
          <p>To register, send an email message to <a href='mailto:register@dane-test.had.dnsops.gov'>register@dane-test.had.dnsops.gov</a></p>
        <!-- <p><a class="btn btn-primary btn-lg" href="#"
        role="button">Learn more »</a></p> -->
      </div>
    </div>

    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
        <div class="col-md-4">
          <h2>Unencrypted</h2>
          <p>Send yourself a plain message. This feature tests your
          ability to receive email from this tester.</p>

          <form class="mailForm" id="form1" action='sendmail.cgi'>
            <label for="email">Your Email</label>    <input type="text" id="email" name="email"/><br/>
            <label for="hash">Your Hash</label>      <input type="text" id="hash" name="hash"/><br/>
            <label for="sigmode">Select Signature Mode(s):</label></br>
            <input type="checkbox" name="none" value="none"> No signature<br/>
            <input type="checkbox" name="pgp"  value="pgp">  OpenPGP signature<br/>
            <input type="checkbox" name="smime" value="smime"> S/MIME signature<br/>
            <input type="submit" value="Send Mail"><br/>
           <span class="status"></span>
          </form>
          <p></p>
          <p><a class="btn btn-default viewDetails" href="#" role="button" id='getplain-details' form='form1'>View details »</a></p>
        </div>
        <div class="col-md-4">
          <h2>SMIMEA</h2>
          <p>Send yourself an SMIME-encrypted message, finding the
          key with the <a href='https://tools.ietf.org/html/draft-ietf-dane-smime-10'>SMIMEA Resource Record</a></p>
          <form class="mailForm" id="form2" action='sendmail.cgi'>
            <label for="email">Your Email</label>    <input type="text" id="email" name="email"/><br/>
            <label for="hash">Your Hash</label>      <input type="text" id="hash" name="hash"/><br/>
            <label for="sigmode">Select Signature Mode(s):</label></br>
            <input type="checkbox" name="none" value="none"> No signature<br/>
            <input type="checkbox" name="smime" value="smime"> S/MIME signature<br/>
            <input type="submit" value="Send Mail"><br/>
           <span class="status"></span>
          </form>
          <p></p>
          <p><a class="btn btn-default viewDetails" href="#" role="button" form='form2'>View details »</a></p>
        </div>
        <div class="col-md-4">
          <h2>OpenPGP</h2>
          <p>Send yourself an an OpenPGP-encrypted message, finding the
          key with the <a href='https://tools.ietf.org/html/draft-ietf-dane-openpgpkey-08'>OPENPGPKEY Resource Record</a></p>
          <form class="mailForm" id="form3" action='sendmail.cgi'>
            <label for="email">Your Email</label>    <input type="text" id="email" name="email"/><br/>
            <label for="hash">Your Hash</label>      <input type="text" id="hash" name="hash"/><br/>
            <label for="sigmode">Select Signature Mode(s):</label></br>
            <input type="checkbox" name="none"  value="none">  No signature<br/>
            <input type="checkbox" name="smime" value="smime"> OpenPGP signature<br/>
            <input type="submit" value="Send Mail"><br/>
           <span class="status"></span>
          </form>
          <p></p>

          <p><a class="btn btn-default viewDetails" href="#" role="button" form='form3'>View details »</a></p>
        </div>
      </div> <!-- row -->
      <div class="row">
        <div class="col-md-4">
          <h2>Lookup</h2>
          <p>Enter an email address and we will look up SMIMEA and OPENPGPKEY records.</p>

          <form class="statusForm" method=GET action="lookup_email.cgi">
            <label for="email">Email</label> <input type="text" id="email" name="email" size=30/><br/>
            <label for="hash">Hash</label> <input type="text" id="hash" name="hash" size=20/> (optional)<br/>
            <br/>
        <p><i><small>Note: Providing the optional hash will cause your lookups to be logged under your account, so that you can audit them later.</small></i></p>
            <input type="submit" value="Lookup" ><br/>
          </form>
        </div>


        <div class="col-md-4">
          <h2>History</h2>
          <p>Provide history of interaction with this server.</p>

          <form class="statusForm" method=GET action="history.cgi">
            <label for="hash">Hash</label> <input type="text" id="hash" name="hash" size=15/><br/>
            <br/>
            <input type="submit" value="Lookup" ><br/>
          </form>
        </div>

        <div class="col-md-4">
          <h2>Generate</h2>
          <div>
            <h3>SMIMEA</h3>
            <p>Based
            on <a href='https://tools.ietf.org/html/draft-ietf-dane-smime-14'>draft-ietf-dane-smime-14</a>
            Network Working Group Internet-Draft:</p>
          
            <p>Please provide a SMIME certificate, by either clicking
            on the box below or dragging in a certificate, and we will
            calculate the appropriate DANE RRs</p>

            <form id="smimea-params">
              <select id="certificate-usage">
                <option value="0">0 CA constraint</option>
                <option value="1">1 Service certificate constraint</option>
                <option value="2">2 Trust anchor assertion</option>
                <option value="3" SELECTED>3 Domain-issued certificate</option>
              </select></br>
              <select id="tlsa-selector">
                <option value="0" SELECTED>0 Full Certificate</option>
                <option value="1">1 SubjectPublicKeyInfo</option>
              </select></br>
              <select id="tlsa-match">
                <option value="0" SELECTED>0 No hash used</option>
                <option value="1">1 SHA-256</option>
                <option value="2">2 SHA-512</option>
              </select></br>
            </form>

            <!-- see http://www.dropzonejs.com/bootstrap.html -->
            <div id="actions" class="row">
              <div class="col-lg-7">
                <!-- The fileinput-button span is used to style the file input
                field as button -->
                <span class="btn btn-success fileinput-button">
                    <span>Add certificate...</span>
                </span>

                <!-- other class="btn btn-primary" -->
                <button type="submit" class="start">
                    <span>Generate</span>
                </button>
                <br/>
              </div>

              <div class="col-lg-5">
                <!-- The global file processing state -->
                <span class="fileupload-process">
                  <div id="total-progress" class="progress progress-striped
                  active" role="progressbar" aria-valuemin="0"
                  aria-valuemax="100" aria-valuenow="0">
                    <div class="progress-bar progress-bar-success"
                  style="width:0%;" data-dz-uploadprogress></div>
                  </div>
                </span>
              </div>
            </div>

             <div class="table">
               <span id="upload-status-area"></span>
             </div>

              <!-- area to hold the list of uploaded files; is this overkill? -->
              <div class="table table-striped files" id="previews">
                <div id="template" class="file-row">
                  <!-- This is used as the file preview template -->
                  <div>
                      <span class="preview"><img data-dz-thumbnail /></span>
                  </div>
                  <div>
                      <p class="name" data-dz-name></p>
                      <strong class="error text-danger"
                      data-dz-errormessage></strong>
                  </div>
                  <div>
                      <p class="size" data-dz-size></p>
                      <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress></div>
                      </div>
                  </div>
                  <div>
                    <button class="btn btn-primary start"> <i class="glyphicon glyphicon-upload"></i>
                      <span>Start</span>
                    </button>
                    <button data-dz-remove class="btn btn-danger delete">
                      <i class="glyphicon glyphicon-trash"></i>
                      <span>Delete</span>
                    </button>
                  </div>
                </div>
              </div>
          </div>
          <div>
            <h3>OPENPGPKEY </h3>
            <p>Based on <a href='https://tools.ietf.org/html/rfc7929'>RFC 7929</a>:</p>
            <p>Enter an email address and an ascii-armored PGP public
              key to calculate the appropriate DANE RRs:</p>
            <form class="statusForm" method=GET action="keygen.cgi">
              <label for="email">Email:</label> <input type="text" id="email" name="email" size=30/><br/>
              <label for="pgpKey">PGP Public Key:</label><br/>
              <textarea rows="4" cols="50" name="pgpKey"> </textarea>
              <br/>
              <input type="submit" value="Generate" ><br/>
            </form>
          </div>
          
<!-- ================================================================ -->


        </div>
      </div> <!-- row -->


      <div class="container">
          <span id="status-area"></span>
      </div>

    <footer>
        <p id='author'> <a href='https://www.nist.gov/itl/antd/'>Advanced Network Technologies Division</a><br/>
                        <a href='https://www.nist.gov/'>National Institute of Standards and Technology</a><br/>
                        <a href='lookup_pubkey.cgi?key=pgp'>PGP public key</a><br/>
        </p> 
    </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/bootstrap/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="/bootstrap/js/bootstrap.min.js"/>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/bootstrap/docs/assets/js/ie10-viewport-bug-workaround.js"></script>

    <script>

//
// Wire up the forms and make them work.
//

$(document).ready(function(){
    // hide the forms that are revealed by the toggle buttons
    $(".mailForm").hide();
    
    // Implement the toggle buttons to view/hide details
    $(".viewDetails").click(function(){
        $("#" + $(this).attr("form")).toggle();
        $("#" + $(this).attr("form")).find(".status").text("");  // clear the status
        if ( $(this).text()=="View details »" ) {
            $(this).text("Hide details »"); 
        } else {
            $(this).text("View details »");
        }
    });
    
    // Send the mail
    $(".mailForm").submit( function(event) {
        var status = $(this).find('.status');
        status.text("working..."); // clear the status
        $.ajax({                       // create an AJAX call...
            data: $(this).serialize(), // get the form data from the form and send it
            type: $(this).attr('method'),
            url: $(this).attr('action'),
            success: function(response) {
                status.html(response);
            }
        });
        
        return false; // cancel original event to prevent submitting
    });
    
    // A status form puts the results in the status section
    $(".statusForm").submit(function(event) {
        var status = $("#status-area");
        status.text("");               // clear the staus
        $.ajax({                       // create an AJAX call...
            data: $(this).serialize(), // send the form data (all fields)
            type: $(this).attr('method'),
            url: $(this).attr('action'),
            success: function(response) {
                status.html(response);
            }
        });
        return false; // cancel original event to prevent form submitting
    });
});

var previewNode = document.querySelector("#template");
previewNode.id = "";
var previewTemplate = previewNode.parentNode.innerHTML;
previewNode.parentNode.removeChild(previewNode);

var myDropzone = new Dropzone(document.body, { // Make the whole body a dropzone
  url: "keygen.cgi", // Set the url for the upload
//  thumbnailWidth: 80,
//  thumbnailHeight: 80,
  parallelUploads: 1,
  previewTemplate: previewTemplate,
  autoQueue: false, // Make sure the files aren't queued until manually added
  previewsContainer: "#previews", // Define the container to display the previews
  clickable: ".fileinput-button", // Define the element that should be used as click trigger to select files.
  success: function(fileobject,response) {
      $("#upload-status-area").html(response);
  }
});

myDropzone.on("addedfile", function(file) {
  // Hookup the start button
  file.previewElement.querySelector(".start").onclick = function() {
  myDropzone.enqueueFile(file); };
});

// Update the total progress bar
myDropzone.on("totaluploadprogress", function(progress) {
  document.querySelector("#total-progress .progress-bar").style.width = progress + "%";
});

myDropzone.on("sending", function(file, xhr, formData) {
  // add the form data
  formData.append("sel", "FOOBAR");
  

  // Show the total progress bar when upload starts
  document.querySelector("#total-progress").style.opacity = "1";
  // And disable the start button
  file.previewElement.querySelector(".start").setAttribute("disabled", "disabled");
});

// Hide the total progress bar when nothing's uploading anymore
myDropzone.on("queuecomplete", function(progress) {
  document.querySelector("#total-progress").style.opacity = "0";
  myDropzone.removeAllFiles(true); // added by SLG
});

// Setup the buttons for all transfers
// The "add files" button doesn't need to be setup because the config
// `clickable` has already been specified.
document.querySelector("#actions .start").onclick = function() {
  myDropzone.enqueueFiles(myDropzone.getFilesWithStatus(Dropzone.ADDED));
};


    </script>
  </body>
</html>
    
